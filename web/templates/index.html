<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Open Face Chinese Poker - Play against AI">
    <meta name="theme-color" content="#007bff">
    
    <title>Open Face Chinese Poker</title>
    
    <!-- CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/game.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/menu.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/statistics.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    
    <!-- PWA -->
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='images/icon-192.png') }}">
    
    <!-- Scripts -->
    <script src="https://cdn.socket.io/4.0.1/socket.io.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="{{ 'mobile' if preferences.is_mobile else '' }} {{ preferences.theme }}-theme">
    <!-- Главное меню -->
    <div class="main-menu" id="mainMenu">
        <div class="menu-header">
            <h1>Open Face Chinese Poker</h1>
            <div class="theme-toggle">
                <button id="themeToggle">
                    <i class="fas fa-moon"></i>
                </button>
            </div>
        </div>
        
        <div class="menu-content">
            <!-- Выбор режима -->
            <div class="menu-section">
                <h2>Game Mode</h2>
                <div class="mode-selector">
                    <button class="mode-btn" data-players="1">
                        <i class="fas fa-user"></i>
                        <span>Single Player</span>
                    </button>
                    <button class="mode-btn" data-players="2">
                        <i class="fas fa-user-friends"></i>
                        <span>Two Players</span>
                    </button>
                    <button class="mode-btn" data-players="3">
                        <i class="fas fa-users"></i>
                        <span>Three Players</span>
                    </button>
                </div>
            </div>

            <!-- Настройки игры -->
            <div class="menu-section">
                <h2>Settings</h2>
                <div class="settings-grid">
                    <div class="setting-item">
                        <label>Fantasy Type:</label>
                        <select id="fantasyType">
                            <option value="normal">Normal</option>
                            <option value="progressive">Progressive</option>
                            <option value="disabled">Disabled</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label>AI Think Time:</label>
                        <div class="slider-container">
                            <input type="range" id="aiThinkTime" min="1" max="60" value="30">
                            <span id="thinkTimeValue">30s</span>
                        </div>
                    </div>
                    <div class="setting-item">
                        <label>Animation Speed:</label>
                        <select id="animationSpeed">
                            <option value="fast">Fast</option>
                            <option value="normal" selected>Normal</option>
                            <option value="slow">Slow</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label>Sound Effects:</label>
                        <label class="switch">
                            <input type="checkbox" id="soundToggle" checked>
                            <span class="slider round"></span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Выбор AI -->
            <div class="menu-section">
                <h2>AI Opponents</h2>
                <div id="aiSelectors" class="ai-selector-grid">
                    <!-- Заполняется динамически -->
                </div>
            </div>

            <!-- Статистика -->
            <div class="menu-section">
                <h2>Statistics</h2>
                <div class="stats-overview">
                    <div class="stat-card">
                        <span class="stat-label">Games Played</span>
                        <span class="stat-value" id="gamesPlayed">0</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-label">Win Rate</span>
                        <span class="stat-value" id="winRate">0%</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-label">Fantasy Rate</span>
                        <span class="stat-value" id="fantasyRate">0%</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-label">Best Score</span>
                        <span class="stat-value" id="bestScore">0</span>
                    </div>
                </div>
                <div class="stats-charts">
                    <canvas id="progressChart"></canvas>
                </div>
            </div>

            <!-- Кнопки управления -->
            <div class="menu-controls">
                <button id="startGame" class="primary-btn">
                    <i class="fas fa-play"></i>
                    Start Game
                </button>
                <button id="aiVsAi" class="secondary-btn">
                    <i class="fas fa-robot"></i>
                    AI vs AI
                </button>
                <button id="trainingMode" class="secondary-btn">
                    <i class="fas fa-graduation-cap"></i>
                    Training Mode
                </button>
                <button id="viewStats" class="secondary-btn">
                    <i class="fas fa-chart-bar"></i>
                    Full Statistics
                </button>
                <button id="tutorial" class="secondary-btn">
                    <i class="fas fa-question-circle"></i>
                    Tutorial
                </button>
            </div>
        </div>
    </div>

    <!-- Игровое поле -->
    <div class="game-container" id="gameContainer" style="display: none;">
        <!-- Верхняя панель -->
        <div class="top-panel">
            <button id="menuButton" class="icon-btn">
                <i class="fas fa-bars"></i>
            </button>
            <div class="game-status">
                <span id="currentTurn">Your turn</span>
                <span id="gameTimer">00:00</span>
            </div>
            <button id="settingsButton" class="icon-btn">
                <i class="fas fa-cog"></i>
            </button>
        </div>

        <!-- Область вышедших карт -->
        <div class="removed-cards-area">
            <div class="removed-cards-scroll">
                <div id="removedCards" class="removed-cards-grid"></div>
            </div>
        </div>

        <!-- Игровые поля -->
        <div class="players-container" id="playersContainer">
            <!-- Заполняется динамически -->
        </div>

        <div class="player-hand-area">
            <!-- Режим тренировки -->
            <div id="trainingControls" class="training-controls" style="display: none;">
                <div class="card-slots-grid">
                    <!-- 17 слотов для карт -->
                    <div id="cardSlots" class="card-slots"></div>
                </div>
                <div class="training-buttons">
                    <button id="distributeCards">Distribute Cards</button>
                    <button id="clearCards">Clear</button>
                </div>
            </div>

            <!-- Обычный режим -->
            <div id="normalHandArea" class="normal-hand">
                <div id="playerHand" class="cards-row"></div>
            </div>
        </div>

        <!-- Боковая панель -->
        <div class="side-panel" id="sidePanel">
            <div class="panel-section">
                <h3>Current Game</h3>
                <div class="game-stats">
                    <div class="stat-row">
                        <span>Score:</span>
                        <span id="currentScore">0 - 0</span>
                    </div>
                    <div class="stat-row">
                        <span>Royalties:</span>
                        <span id="currentRoyalties">0</span>
                    </div>
                    <div class="stat-row">
                        <span>Fantasy Status:</span>
                        <span id="fantasyStatus">Normal</span>
                    </div>
                </div>
            </div>

            <div class="panel-section">
                <h3>Move History</h3>
                <div id="moveHistory" class="move-history"></div>
            </div>

            <div class="panel-section">
                <h3>Progress</h3>
                <canvas id="gameProgressChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Шаблоны -->
    <template id="playerBoardTemplate">
        <div class="player-board">
            <div class="player-info">
                <span class="player-name"></span>
                <span class="player-score"></span>
                <div class="player-status"></div>
            </div>
            <div class="board-pyramid">
                <div class="pyramid-row top">
                    <div class="card-slot" data-position="0"></div>
                    <div class="card-slot" data-position="1"></div>
                    <div class="card-slot" data-position="2"></div>
                </div>
                <div class="pyramid-row middle">
                    <div class="card-slot" data-position="3"></div>
                    <div class="card-slot" data-position="4"></div>
                    <div class="card-slot" data-position="5"></div>
                    <div class="card-slot" data-position="6"></div>
                    <div class="card-slot" data-position="7"></div>
                </div>
                <div class="pyramid-row bottom">
                    <div class="card-slot" data-position="8"></div>
                    <div class="card-slot" data-position="9"></div>
                    <div class="card-slot" data-position="10"></div>
                    <div class="card-slot" data-position="11"></div>
                    <div class="card-slot" data-position="12"></div>
                </div>
            </div>
            <div class="discarded-cards">
                <!-- Сброшенные карты будут отображаться здесь -->
            </div>
        </div>
    </template>

    <!-- Модальные окна -->
    <div id="gameEndModal" class="modal" style="display: none;">
        <div class="modal-content">
            <h2>Game Over</h2>
            <div id="gameResults"></div>
            <div class="modal-buttons">
                <button id="newGame" class="primary-btn">New Game</button>
                <button id="returnToMenu" class="secondary-btn">Return to Menu</button>
            </div>
        </div>
    </div>

    <div id="aiVsAiModal" class="modal" style="display: none;">
        <div class="modal-content">
            <h2>AI vs AI Mode</h2>
            <div class="ai-settings">
                <div class="setting-group">
                    <label>First AI:</label>
                    <select id="firstAiSelect"></select>
                </div>
                <div class="setting-group">
                    <label>Second AI:</label>
                    <select id="secondAiSelect"></select>
                </div>
                <div class="setting-group">
                    <label>Think Time:</label>
                    <input type="range" id="aiVsAiThinkTime" min="1" max="60" value="30">
                    <span id="aiVsAiThinkTimeValue">30s</span>
                </div>
            </div>
            <div class="modal-buttons">
                <button id="startAiVsAi" class="primary-btn">Start</button>
                <button id="cancelAiVsAi" class="secondary-btn">Cancel</button>
            </div>
        </div>
    </div>

    <div id="settingsModal" class="modal" style="display: none;">
        <div class="modal-content">
            <h2>Settings</h2>
            <div class="settings-form">
                <!-- Заполняется динамически -->
            </div>
            <div class="modal-buttons">
                <button id="saveSettings" class="primary-btn">Save</button>
                <button id="cancelSettings" class="secondary-btn">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Скрипты -->
    <script src="{{ url_for('static', filename='js/game.js') }}" type="module"></script>
    <script src="{{ url_for('static', filename='js/ui.js') }}" type="module"></script>
    <script src="{{ url_for('static', filename='js/statistics.js') }}" type="module"></script>
    <script src="{{ url_for('static', filename='js/training.js') }}" type="module"></script>

    <!-- Service Worker -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => {
                        console.log('ServiceWorker registered');
                    })
                    .catch(error => {
                        console.log('ServiceWorker registration failed:', error);
                    });
            });
        }
    </script>
</body>
</html>
